<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

  	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>



    <script src="./node_modules/web3/dist/web3.min.js"></script>
    <script src="./node_modules/@metamask/detect-provider/dist/detect-provider.min.js"></script>

   	<script type="text/javascript">
   	// Source code to interact with smart contract

   	var contractAddress = '0xFbDbE089a04C31D3C35dB4A5bDE43cb653EeE179';

	var abi = JSON.parse( '[{"inputs":[],"name":"createAuction","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"auctions","outputs":[{"internalType":"contract Auction","name":"","type":"address"}],"stateMutability":"view","type":"function"}]' );

	async function loadWeb3() {
	    if (window.ethereum) {
	        window.web3 = new Web3(window.ethereum);
	        window.ethereum.enable();
	    }
	}

	async function load() {
	    await loadWeb3();
	    window.contract = await loadContract();
	    updateStatus('Ready!');
	}

	function updateStatus(status) {
	    console.log(status);
	}

	async function loadContract() {
	    return await new window.web3.eth.Contract(abi, contractAddress);
	}

	async function getCurrentAccount() {
	    const accounts = await window.web3.eth.getAccounts();
	    return accounts[0];
	}

	load();
   	/*const provider = detectEthereumProvider();
      if (provider) {
        const web3 = new Web3(provider);
        // now you have the provider
        // after this you can place the logic



	   try {
	      const instance = new web3.eth.Contract(
	        contractABI,
	        contractAddress,
	      );
	      var userAccount;

	      const accounts = await web3.eth.getAccounts();
	      if (accounts[0] !== userAccount) {
	          userAccount = accounts[0];
	      }
	      
	    } catch (error) {
	      // Catch any errors for any of the above operations.
	      alert(
	        `Failed to load web3, accounts, or contract. Check console for details.`,
	      );
	      console.error(error);
	    }
	  // handle the case provider is not available
	  } else {
	    
	    console.error("Please install Metamask");
	  };
	*/

	// web3 provider with fallback for old version
	/*
	window.addEventListener('load', async () => {
	  // New web3 provider
	  if (window.ethereum) {
	      window.web3 = new Web3(ethereum);
	      try {
	          // ask user for permission
	          await ethereum.enable();
	          // user approved permission
	      } catch (error) {
	          // user rejected permission
	          console.log('user rejected permission');
	      }
	  }

	  // No web3 provider
	  else {
	      console.log('No web3 provider detected');
	  }
	});
	console.log (window.web3.currentProvider)


	//contract instance
	contract = new web3.eth.Contract(abi, contractAddress);

	// Accounts
	var account;

	web3.eth.getAccounts(function(err, accounts) {
	  if (err != null) {
	    alert("Error retrieving accounts.");
	    return;
	  }
	  if (accounts.length == 0) {
	    alert("No account found! Make sure the Ethereum client is configured properly.");
	    return;
	  }
	  account = accounts[0];
	  console.log('Account: ' + account);
	  web3.eth.defaultAccount = account;
	});
*/
	async function create_auction(){
		const account = await getCurrentAccount();
		var result = await window.contract.methods.createAuction().call();
		console.log(result);

		/*contract.methods.createAuction().call().then( function( info ) {
	    	console.log("info: ", info);
	    	document.getElementById('result').innerHTML = "Created new Auction: " + info;
  		});*/
	}

	





   	</script>

	<title></title>
</head>
<body>

	<button id="createAuction" onclick="create_auction()" class="btn btn-primary">Create new auction</button>

	<p id="result"></p>

</body>
</html>